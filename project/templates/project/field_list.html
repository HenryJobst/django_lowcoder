{% extends "project/base_generic.html" %}

{% block content %}
{% load project_filters %}
<!--suppress HtmlUnknownAttribute -->
<h1 class="h2">Spalten ({{ field_list|length }})</h1>
<div>
  <a role="button"
     href="{% url 'project_create_field' request.session.selected_model %}"><i
    class="feather-48" data-feather="folder-plus"></i>
  </a>
</div>
{% if field_list %}
<div class="table-responsive">
  <table id="field-table" class="table table-striped table-sm">
    <thead>
    <tr>
      <th scope="col">Name</th>
      <th scope="col">Reihenfolge</th>
      <th scope="col">Datentyp</th>
      <th scope="col">Länge</th>
      <th scope="col">Standard-Wert</th>
      <th scope="col">Aktionen</th>
    </tr>
    </thead>
    <tbody>
    {% for field in field_list %}
    <tr>
      <td {% if field.exclude %} class="text-decoration-line-through" {% endif %}>
        <a href="{% url 'project_update_field' field.id %}?next={{request.path}}">
          {{ field.name }} </a>
      </td>
      <td {% if field.exclude %} class="text-decoration-line-through" {% endif %}>
        {{ field.index }}
      </td>
      <td {% if field.exclude %} class="text-decoration-line-through" {% endif %}>
        {{ field.datatype|datatype_as_str }}
      </td>
      <td {% if field.exclude %} class="text-decoration-line-through" {% endif %}>
        {{ field.max_length|default_if_none:'' }}
        {{ field.max_digits|default_if_none:'' }}
      </td>
      <td {% if field.exclude %} class="text-decoration-line-through" {% endif %}>
        {{ field.default_value|default_if_none:'' }}
      </td>
      <td>
        <a title="Bearbeiten" role="button"
           href="{% url 'project_update_field' field.id %}?next={{request.path}}"><i
          class="feather-24 align-top me-1"
          data-feather="edit"></i></a>
        <a title="Löschen" role="button"
           href="{% url 'project_delete_field' field.id %}?next={{request.path}}"><i
          class="feather-24 align-top me-1"
          data-feather="trash-2"></i></a>

        {% if field.index > 1 %}

        <a hx-ext="debug" hx-post="{% url 'project_field_up' field.id %}"
           hx-trigger="click" hx-target="#field-table" hx-select="#field-table" hx-swap="innerHTML"
           title="Hoch"
           role="button"
           href="#"><i
          class="feather-24 align-top me-1"
          data-feather="arrow-up"></i></a>

        {% else %}

        <span class="me-1" style="display: inline-block; width: 24px !important"></span>

        {% endif %}

        {% if field.index < field_list|length %}

        <a hx-ext="debug" hx-post="{% url 'project_field_down' field.id %}"
           hx-trigger="click" hx-target="#field-table" hx-select="#field-table" hx-swap="innerHTML"
           title="Runter"
           role="button"
           href="#"><i class="feather-24 align-top me-1" data-feather="arrow-down"></i></a>

        {% else %}

        <span class="me-1" style="display: inline-block; width: 24px !important"></span>

        {% endif %}
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
  <script>
    document.body.addEventListener('htmx:afterSwap', function(evt) {
      feather.replace();
    });
  </script>
</div>
{% else %}
<p>Es gibt noch keine Spalten.</p>
{% endif %}
{% endblock %}
